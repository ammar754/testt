<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ticket System</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 0;
      transition: background 0.3s, color 0.3s;
    }
    body.dark { background: #18181b; color: #f3f4f6; }
    header {
      background: #4f46e5;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
    }
    .container {
      max-width: 900px;
      margin: 20px auto;
      padding: 15px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    body.dark .container { background: #27272a; }
    .hidden { display: none; }
    .ticket {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 12px;
      background: #fafafa;
    }
    body.dark .ticket { background: #3f3f46; border-color: #555; }
    .ticket.high { border-left: 5px solid red; }
    .ticket.medium { border-left: 5px solid orange; }
    .ticket.low { border-left: 5px solid green; }
    .ticket-header {
      font-weight: bold;
      display: flex;
      justify-content: space-between;
    }
    .btn {
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin: 3px;
      font-size: 14px;
    }
    .btn-primary { background: #4f46e5; color: white; }
    .btn-danger { background: #dc2626; color: white; }
    .btn-success { background: #16a34a; color: white; }
    .btn-light { background: #e5e7eb; }
    .input, select, textarea {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
      border: 1px solid #ddd;
      border-radius: 6px;
    }
    textarea { resize: vertical; }
    .reply {
      margin-top: 8px;
      padding: 6px;
      border-left: 3px solid #4f46e5;
      background: #eef2ff;
      border-radius: 6px;
    }
    body.dark .reply { background: #1e1b4b; }
    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
  </style>
</head>
<body>
  <header>
    Ticket Support System
  </header>
  
  <div class="container" id="loginContainer">
    <h2>Login</h2>
    <input class="input" id="username" placeholder="Username">
    <input class="input" id="password" type="password" placeholder="Password">
    <button class="btn btn-primary" onclick="login()">Login</button>
    <p><small>Login sebagai <b>admin</b> gunakan password: <code>admin123</code></small></p>
  </div>
  
  <div class="container hidden" id="mainContainer">
    <div class="topbar">
      <div>Halo, <span id="userRole"></span></div>
      <div>
        <button class="btn btn-light" onclick="toggleTheme()">ðŸŒ™ Mode</button>
        <button class="btn btn-danger" onclick="logout()">Logout</button>
      </div>
    </div>
    <hr>
    
    <!-- User Ticket Form -->
    <div id="userSection" class="hidden">
      <h2>Buat Tiket Baru</h2>
      <input class="input" id="ticketTitle" placeholder="Judul Tiket">
      <select id="ticketCategory" class="input">
        <option>Bug</option>
        <option>Report Player</option>
        <option>Pertanyaan</option>
        <option>Lainnya</option>
      </select>
      <select id="ticketPriority" class="input">
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
      </select>
      <textarea id="ticketMessage" class="input" rows="3" placeholder="Deskripsi masalah..."></textarea>
      <button class="btn btn-success" onclick="createTicket()">Buat Tiket</button>
    </div>
    
    <!-- Admin Controls -->
    <div id="adminSection" class="hidden">
      <h2>Panel Admin</h2>
      <input id="searchBox" class="input" placeholder="Cari tiket..." oninput="renderTickets()">
      <select id="filterStatus" class="input" onchange="renderTickets()">
        <option value="all">Semua Status</option>
        <option value="open">Open</option>
        <option value="closed">Closed</option>
      </select>
    </div>
    
    <h2>Daftar Tiket</h2>
    <div id="ticketList"></div>
  </div>
  
  <script>
    let currentUser = null;
    let tickets = JSON.parse(localStorage.getItem("tickets") || "[]");
    
    function saveTickets() {
      localStorage.setItem("tickets", JSON.stringify(tickets));
    }
    
    function login() {
      let user = document.getElementById("username").value.trim();
      let pass = document.getElementById("password").value;
      
      if (!user) { alert("Isi username!"); return; }
      
      if (user === "admin" && pass === "admin123") {
        currentUser = { name: "Admin", role: "admin" };
      } else {
        currentUser = { name: user, role: "user" };
      }
      
      document.getElementById("loginContainer").classList.add("hidden");
      document.getElementById("mainContainer").classList.remove("hidden");
      document.getElementById("userRole").innerText = currentUser.role + " (" + currentUser.name + ")";
      
      if (currentUser.role === "user") {
        document.getElementById("userSection").classList.remove("hidden");
      } else {
        document.getElementById("adminSection").classList.remove("hidden");
      }
      
      renderTickets();
    }
    
    function logout() {
      currentUser = null;
      document.getElementById("loginContainer").classList.remove("hidden");
      document.getElementById("mainContainer").classList.add("hidden");
    }
    
    function createTicket() {
      let title = document.getElementById("ticketTitle").value;
      let category = document.getElementById("ticketCategory").value;
      let priority = document.getElementById("ticketPriority").value;
      let message = document.getElementById("ticketMessage").value;
      
      if (!title || !message) { alert("Isi semua field!"); return; }
      
      let newTicket = {
        id: Date.now(),
        title, category, priority,
        message,
        user: currentUser.name,
        status: "open",
        replies: []
      };
      
      tickets.push(newTicket);
      saveTickets();
      renderTickets();
      
      document.getElementById("ticketTitle").value = "";
      document.getElementById("ticketMessage").value = "";
    }
    
    function replyTicket(id) {
      let reply = prompt("Balas tiket:");
      if (!reply) return;
      let ticket = tickets.find(t => t.id === id);
      ticket.replies.push({ from: currentUser.name, message: reply, date: new Date().toLocaleString() });
      saveTickets();
      renderTickets();
    }
    
    function closeTicket(id) {
      let ticket = tickets.find(t => t.id === id);
      ticket.status = "closed";
      saveTickets();
      renderTickets();
    }
    
    function renderTickets() {
      let list = document.getElementById("ticketList");
      list.innerHTML = "";
      
      let search = document.getElementById("searchBox")?.value.toLowerCase() || "";
      let filter = document.getElementById("filterStatus")?.value || "all";
      
      tickets.filter(t => 
        (currentUser.role === "admin" || t.user === currentUser.name) &&
        (t.title.toLowerCase().includes(search) || t.message.toLowerCase().includes(search)) &&
        (filter === "all" || t.status === filter)
      ).forEach(t => {
        let div = document.createElement("div");
        div.className = `ticket ${t.priority}`;
        div.innerHTML = `
          <div class="ticket-header">
            <span>[${t.status.toUpperCase()}] ${t.title} - <small>${t.category}</small></span>
            <span>By: ${t.user}</span>
          </div>
          <p>${t.message}</p>
          ${t.replies.map(r => `<div class="reply"><b>${r.from}:</b> ${r.message} <br><small>${r.date}</small></div>`).join("")}
          ${currentUser.role === "admin" && t.status === "open" ? `
            <button class="btn btn-success" onclick="replyTicket(${t.id})">Balas</button>
            <button class="btn btn-danger" onclick="closeTicket(${t.id})">Tutup</button>
          ` : ""}
        `;
        list.appendChild(div);
      });
    }
    
    function toggleTheme() {
      document.body.classList.toggle("dark");
    }
  </script>
</body>
</html>
